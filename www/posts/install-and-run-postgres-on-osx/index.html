<!DOCTYPE html>
<html lang="en">
<head>
  <title>Install and Run Postgres on OSX</title>

  <meta charset="utf-8">

  <link href="https://fonts.googleapis.com/css?family=Roboto|Montserrat" rel="stylesheet" type="text/css">
  <link href="/css/styles.css" rel="stylesheet" type="text/css" />
</head>

<body>
  <nav>
  <ul>
    <li><a href="/">Home</a></li>
    <li><a href="/posts">Blog</a></li>
    <li><a href="/projects">Portfolio</a></li>
  </ul>
</nav>

  <div class="container">
    
<article class="post">
  
  <h1 class="title">Install and Run Postgres on OSX</h1><span> - 12/16/2015</span>
  <hr />
  <p>This article covers installation the postgres server on OSX. It discusses how to launch the server in the foreground from the terminal or in the background as a daemon / agent. In addition, it discusses how to connect to the server with the <code>psql</code> command.</p>
<h2 id="installing">Installing</h2>
<p>Install Postgres via Homebrew. If you don&#39;t have Homebrew installed or know what it does I suggest you, <a href="http://brew.sh/">check it out.</a></p>
<pre><code class="lang-bash">brew update
brew install postgres
</code></pre>
<p>This command will install Postgres into your <code>/usr/local</code> directory and adds the following directories:</p>
<ul>
<li><code>/usr/local/var/postgres</code> is where the database and logs are stored</li>
<li><code>/usr/local/opt/postgresql</code> contains a <code>.plist</code> file which contains some metadata about how to launch Postgres.</li>
</ul>
<h2 id="running">Running</h2>
<p>In order to access a PostgreSQL database, the postgres server needs to be running.</p>
<p>We can run the server in the foreground by using the <code>postgres</code> command:</p>
<pre><code class="lang-bash">postgres -D /usr/local/var/postgres
</code></pre>
<p>The <code>-D</code> argument tells <code>postgres</code> where the database is.</p>
<p>In another terminal window we can now access the database with the <code>psql</code> command.</p>
<pre><code class="lang-bash">psql
</code></pre>
<p>(Remember if you want to exit <code>psql</code> you can quit by typing <code>\q</code> and then enter or just press <code>ctrl + d</code>)</p>
<p>The problem with running the postgres server in the foreground is it needs to be ran in a terminal - and the terminal needs to stay open. If for some reason the terminal closes or the connection to the terminal stops then the postgres server shuts down.</p>
<p>This is why it is recommended to launch the postgres as a daemon. A daemon is a program that runs in the background, sometimes for long periods of time, that doesn&#39;t interact with the user. The postgres server works great as a daemon, because it will keep running until told to stop or the computer is shut down. The best part is, we don&#39;t need to have an extra terminal window open.</p>
<p>There are two ways to run the postgres server as a daemon on OSX, automatically and manually.</p>
<h3 id="automatically-running-the-postgres-server-as-a-daemon">Automatically running the Postgres server as a daemon</h3>
<p>If desired, the postgres server can be configured to launch as a deamon in the background every time the user signs in:</p>
<pre><code class="lang-bash">ln -sfv /usr/local/opt/postgresql/*.plist ~/Library/LaunchAgents
launchctl load ~/Library/LaunchAgents/homebrew.mxcl.postgresql.plist
</code></pre>
<p>Let&#39;s talk about what each of these commands does so we understand why it runs automatically.</p>
<pre><code class="lang-bash">ln -sfv /usr/local/opt/postgresql/*.plist ~/Library/LaunchAgents
</code></pre>
<p>Here is an explainshell breaking down the <a href="http://www.explainshell.com/explain?cmd=ln+-sfv+%2Fusr%2Flocal%2Fopt%2Fpostgresql%2F*.plist+~%2FLibrary%2FLaunchAgents">ln -svf</a> command.</p>
<p>This takes the <code>.plist</code> file in <code>/usr/local/opt/postgressql</code> and creates a symbolic link in the <code>~/Library/LaunchAgents</code> directory.</p>
<p>A symbolic link creates a reference to a file, this allows the file seem like it is in many different locations but is only in one. Here we <code>/usr/local/opt/postgressql</code>, but the computer also thinks it is also at another URI, <code>~/Library/LaunchAgents</code>. If the file is modified in either spot, it will modify the original file.</p>
<pre><code class="lang-bash">launchctl load ~/Library/LaunchAgents/homebrew.mxcl.postgresql.plist
</code></pre>
<p><code>launchctl</code> is what OSX uses to load daemons and agents in the background. It is used to manage the computers networking, voice over, USB and other long running processes.</p>
<p>We can see a list of everything <code>launchctl</code> is running by issuing the command:</p>
<pre><code class="lang-bash">launchctl list
</code></pre>
<p>When a user signs in, <code>launchctl</code> reads all the <code>.plist</code> files in the directory <code>~/Library/LaunchAgents</code>. It will see the symbolic link from the <code>ln</code> command and read postgres&#39; <code>.plist</code> file. It will use this data to start the postgres server as a daemon in the background.</p>
<p>The command, <code>launchctl load</code> loads the <code>.plist</code> file and starts the daemon immediately, this way the user doesn&#39;t have to logout and back in.</p>
<p>Since the server is running as a daemon we can now connect to it via our application or the <code>psql</code> shell:</p>
<pre><code class="lang-bash">psql
</code></pre>
<p>(Remember if you want to exit <code>psql</code> you can quit by typing <code>\q</code> and then enter or just press <code>ctrl + d</code>)</p>
<h4 id="stopping-postgres-from-automatically-launching">Stopping Postgres from Automatically Launching</h4>
<p>If you configured the postgres server to auto launch and you don&#39;t want it to, it only takes a couple of steps.</p>
<p>First, unload the daemon, this will stop the process in the background as well:</p>
<pre><code class="lang-bash">launchctl unload ~/Library/LaunchAgents/homebrew.mxcl.postgresql.plist
</code></pre>
<p>Then remove the symbolic link that was made with the <code>ln</code> command. This way, <code>launchctl</code> doesn&#39;t start the postgres server the next time the user logs in.</p>
<pre><code class="lang-bash">unlink ~/Library/LaunchAgents/homebrew.mxcl.postgresql.plist
</code></pre>
<h3 id="manually-run-the-postgres-server-as-a-daemon">Manually Run The Postgres Server as a Daemon</h3>
<p>You can manually start Postgres server as a daemon with the <code>launchctl</code> command. However, it is recommended to use <code>pg_ctl</code> instead,</p>
<pre><code class="lang-bash">pg_ctl -D /usr/local/var/postgres -l /usr/local/var/postgres/server.log start
</code></pre>
<p>or stop it:</p>
<pre><code class="lang-bash">pg_ctl -D /usr/local/var/postgres stop -s -m fast
</code></pre>
<p>These commands are hard to remember, looks like a great opportunity to turn into a script:</p>
<pre><code class="lang-bash">#create startpostgres.sh
echo &quot;#!/bin/bash&quot; &gt; startpostgres.sh
echo &quot;g_ctl -D /usr/local/var/postgres -l /usr/local/var/postgres/server.log start&quot; &gt;&gt; startpostgres.sh

#create stoppostgres.sh
echo &quot;#!/bin/bash&quot; &gt; stoppostgres.sh
echo &quot;pg_ctl -D /usr/local/var/postgres stop -s -m fast&quot; &gt;&gt; stoppostgres.sh

#set them as executable
chmod 744 ./startpostgres.sh
chmod 744 ./stoppostgres.sh
</code></pre>
<p>Finally, run the scripts and open up a shell to the server:</p>
<pre><code class="lang-bash">./startposgres.#!/bin/sh
psql
</code></pre>
<p>(Remember if you want to exit <code>psql</code> you can quit by typing <code>\q</code> and then enter or just press <code>ctrl + d</code>)</p>

</article>

  </div>
  <script src="/js/prism.js"></script>
  
<script src="http://localhost:35729/livereload.js"></script>


</body>
</html>
